<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tiny Tools</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0f1220; --panel:#14182a; --ink:#e9ecf8; --muted:#9aa3bf;
    --radius:16px; --shadow:0 14px 34px rgba(0,0,0,.36);
    --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f7fb; --panel:#ffffff; --ink:#0f1426; --muted:#596486; --shadow:0 16px 36px rgba(12,24,60,.08); }
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:var(--font); color:var(--ink);
    background:
      radial-gradient(1200px 600px at 0% -10%, rgba(110,86,207,.28), transparent 60%),
      radial-gradient(900px 400px at 110% 0%, rgba(69,231,179,.22), transparent 60%),
      var(--bg);
  }
  header{padding:22px 18px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg, rgba(255,255,255,.03), transparent)}
  .wrap{max-width:1100px;margin:0 auto;padding:0 12px}
  h1{margin:0 0 6px;font-size:22px;letter-spacing:.2px}
  .sub{margin:0;color:var(--muted);font-size:13px}
  main{padding:18px}
  .board{
    background:var(--panel); border:1px solid rgba(255,255,255,.08);
    border-radius:18px; box-shadow:var(--shadow); padding:16px;
  }
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  @media (max-width:720px){ .grid{grid-template-columns:repeat(6,1fr)} }
  @media (max-width:520px){ .grid{grid-template-columns:repeat(2,1fr)} }
  a.tool{
    grid-column: span 3; display:inline-flex; align-items:center; justify-content:center;
    text-decoration:none; text-align:center; padding:14px 10px; border-radius:14px;
    color:#fff; font-weight:700; letter-spacing:.2px; min-height:56px;
    box-shadow:0 10px 22px rgba(0,0,0,.25); transition:transform .06s ease, box-shadow .12s ease;
    border:1px solid rgba(255,255,255,.12);
    word-break:break-word;
  }
  @media (max-width:720px){ a.tool{grid-column:span 6} }
  @media (max-width:520px){ a.tool{grid-column:span 2} }
  a.tool:hover{transform:translateY(-1px); box-shadow:0 12px 26px rgba(0,0,0,.28)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px}
  input[type="search"]{
    flex:1; min-width:200px; padding:11px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,.12); background:rgba(10,12,22,.45); color:var(--ink); outline:none
  }
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  .empty{margin-top:10px;padding:14px;border:1px dashed rgba(255,255,255,.18);border-radius:12px;color:var(--muted);text-align:center}
  footer{padding:16px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Tiny Tools</h1>
    <p class="sub">Auto-buttons for every file in <span class="pill">/tools</span>. Click to open in a new tab.</p>
    <div class="row">
      <input id="q" type="search" placeholder="Filter by filenameâ€¦" />
      <span class="pill" id="count">â€”</span>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="board">
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No files found in <span class="pill">/tools</span>.</div>
  </div>
</main>

<footer class="wrap">
  If your repo is private or API-limited, add a <code>tools.json</code> manifest in <code>/tools</code> like <code>["dealrooms/index.html","meeting/index.html"]</code>.
</footer>

<script>
/* ---------- helpers ---------- */
const $ = (s)=>document.querySelector(s);
const grid = $("#grid"), empty = $("#empty"), q = $("#q"), count = $("#count");

function parseOwnerRepo(){
  // username.github.io[/repo]/tools/...
  const owner = location.hostname.split(".")[0];
  const parts = location.pathname.split("/").filter(Boolean);
  const repo = parts.length ? parts[0] : `${owner}.github.io`; // project vs user site
  return {owner, repo};
}
function toolsApiPath(){ return "tools"; } // list only the folder we're in

// Deterministic hash â†’ hue for per-file color
function hash(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
function hueFromName(name){ return (hash(name) % 360); }
function emojiFor(name){
  const emojis = ["âœ¨","ðŸš€","ðŸ§©","ðŸ› ï¸","âš¡","ðŸ“Š","ðŸ§ ","ðŸ“Ž","ðŸŽ¯","ðŸ§ª","ðŸ“","ðŸ—‚ï¸","ðŸ”§","ðŸ“","ðŸ§­","ðŸ’¡"];
  return emojis[ hash(name) % emojis.length ];
}
function titleFromPath(p){ return p.split("/").pop(); } // filename only

function toHref(rel){
  // build absolute URL to file relative to /tools/
  const base = location.pathname.endsWith('/') ? location.pathname : location.pathname.replace(/\/[^\/]*$/, '/');
  return new URL(rel, location.origin + base).toString();
}

function makeButton(filePath){
  const filename = titleFromPath(filePath);
  const hue = hueFromName(filePath);
  const bg = `hsl(${hue} 75% 45%)`;
  const bg2= `hsl(${(hue+25)%360} 80% 42%)`;
  const emoji = emojiFor(filePath);
  const a = document.createElement("a");
  a.className = "tool";
  a.href = toHref(filePath);
  a.target = "_blank";
  a.rel = "noopener";
  a.style.background = `linear-gradient(180deg, ${bg}, ${bg2})`;
  a.textContent = filename + " " + emoji;
  a.title = filePath;
  a.dataset.name = filename.toLowerCase();
  return a;
}

function render(files){
  grid.innerHTML = "";
  if(!files.length){ empty.style.display="block"; count.textContent="0 files"; return; }
  empty.style.display = "none";
  files.forEach(f => grid.appendChild(makeButton(f)));
  count.textContent = files.length + (files.length===1 ? " file" : " files");
}
function filter(){
  const term = (q.value||"").trim().toLowerCase();
  let shown = 0;
  grid.querySelectorAll(".tool").forEach(btn=>{
    const match = !term || btn.dataset.name.includes(term);
    btn.style.display = match ? "" : "none";
    if(match) shown++;
  });
  empty.style.display = shown ? "none" : "block";
  count.textContent = shown + (shown===1 ? " file" : " files");
}

/* ---------- data sources ---------- */
async function listViaGitHubAPI(){
  const {owner, repo} = parseOwnerRepo();
  const api = `https://api.github.com/repos/${owner}/${repo}/contents/${toolsApiPath()}`;
  const res = await fetch(api, {cache:"no-store"});
  if(!res.ok) throw new Error(res.status+" "+res.statusText);
  const data = await res.json();
  // Only files directly inside /tools (ignore subfolders per your ask)
  return data.filter(x=>x.type==="file").map(x=>x.name);
}
async function listViaManifest(){
  try{
    const res = await fetch("./tools.json", {cache:"no-store"});
    if(!res.ok) return null;
    const arr = await res.json();
    // Manifest can be array of strings or objects with .path
    return arr.map(x => (typeof x==="string" ? x : x.path)).filter(Boolean);
  }catch{ return null; }
}

/* ---------- boot ---------- */
(async function(){
  let files = [];
  try{
    files = await listViaGitHubAPI();
  }catch(e){
    // Fallback: tools.json manifest in /tools
    const manifest = await listViaManifest();
    if(manifest) files = manifest;
  }
  // Sort by name, stable color comes from hash
  files.sort((a,b)=>a.localeCompare(b));
  render(files);
  q.addEventListener("input", filter);
})();
</script>
</body>
</html>
