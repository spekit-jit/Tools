<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="light dark" />
<title>tools</title>
<style>
  :root{ --bg:#0f1220; --panel:#14182a; --ink:#e9ecf8; --radius:16px; --shadow:0 16px 40px rgba(0,0,0,.38) }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f7fb; --panel:#ffffff; --ink:#0f1426; --shadow:0 18px 40px rgba(12,24,60,.08) }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    background:
      radial-gradient(1200px 520px at 0% -10%, rgba(110,86,207,.25), transparent 60%),
      radial-gradient(900px 360px at 110% 0%, rgba(69,231,179,.20), transparent 60%),
      var(--bg);
    display:flex; align-items:stretch; justify-content:center;
  }
  .board{
    width:100%; max-width:1100px; margin:16px; padding:16px;
    background:var(--panel); border:1px solid rgba(255,255,255,.08);
    border-radius:18px; box-shadow:var(--shadow);
  }
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:12px}
  @media (max-width:980px){ .grid{grid-template-columns:repeat(8,1fr)} }
  @media (max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} }

  a.tool{
    grid-column:span 3;
    display:inline-flex; align-items:center; justify-content:center;
    text-decoration:none; text-align:center; padding:14px 12px; min-height:56px;
    border-radius:14px; color:#fff; font-weight:700; letter-spacing:.2px;
    border:1px solid rgba(255,255,255,.12);
    box-shadow:0 12px 26px rgba(0,0,0,.25);
    transition:transform .06s, box-shadow .12s; word-break:break-word; backdrop-filter:saturate(110%);
  }
  @media (max-width:980px){ a.tool{grid-column:span 4} }
  @media (max-width:640px){ a.tool{grid-column:span 2} }
  a.tool:hover{ transform:translateY(-1px); box-shadow:0 14px 30px rgba(0,0,0,.30) }

  /* tiny diagnostics (always visible for now so we can debug quickly) */
  #dbg{position:fixed;bottom:8px;right:10px;background:rgba(0,0,0,.50);color:#fff;
       padding:8px 10px;border-radius:10px;font:12px/1.3 ui-monospace,monospace;max-width:60ch;white-space:pre-wrap}
</style>
</head>
<body>
  <div class="board">
    <div id="grid" class="grid"></div>
  </div>
  <div id="dbg">loadingâ€¦</div>

<script>
/* ===== CONFIG: hard-code your repo (no auto-detection) ===== */
const OWNER = "spekit-jit";
const REPO  = "spekit-jit.github.io";      // user site repo
const TOOLS_PATH = "tools";                 // folder to list
const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${TOOLS_PATH}`;
const RAW_TOOLS_JSON = "./tools.json";      // fallback manifest path (inside /tools)

/* ===== DOM ===== */
const grid = document.getElementById("grid");
const dbg  = document.getElementById("dbg");

/* ===== helpers ===== */
function toHref(filename){ return `${location.origin}/tools/${filename.replace(/^\/+/,'')}`; }
function hash(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
function hueFromName(name){ return hash(name)%360; }
function emojiFor(name){ const e=["âœ¨","ðŸš€","ðŸ§©","ðŸ› ï¸","âš¡","ðŸ“Š","ðŸ§ ","ðŸ“Ž","ðŸŽ¯","ðŸ§ª","ðŸ“","ðŸ—‚ï¸","ðŸ”§","ðŸ“","ðŸ§­","ðŸ’¡","ðŸª„","ðŸ”—","ðŸ–‡ï¸","ðŸ“Œ"]; return e[ hash(name) % e.length ]; }
function stripExt(s){ return s.replace(/\.html?$/i,''); }

function makeButton(filename){
  const hue = hueFromName(filename);
  const bg1 = `hsl(${hue} 75% 46%)`, bg2 = `hsl(${(hue+24)%360} 78% 44%)`;
  const a = document.createElement('a');
  a.className = 'tool';
  a.href = toHref(filename);
  a.target = '_blank';
  a.rel = 'noopener';
  a.style.background = `linear-gradient(180deg, ${bg1}, ${bg2})`;
  a.textContent = stripExt(filename) + ' ' + emojiFor(filename);
  a.title = filename;
  return a;
}

function render(files, source){
  grid.innerHTML = '';
  const htmlFiles = files
    .filter(n => /\.html?$/i.test(n))
    .filter(n => !/^index\.html?$/i.test(n))
    .sort((a,b)=>a.localeCompare(b));
  htmlFiles.forEach(n => grid.appendChild(makeButton(n)));
  dbg.textContent = `${htmlFiles.length} file(s) from ${source}\n` +
                    `Repo: ${OWNER}/${REPO}\n` +
                    `API: ${API_URL}`;
}

/* ===== data sources ===== */
async function fetchManifest(){
  try{
    const res = await fetch(RAW_TOOLS_JSON + "?cb=" + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("manifest " + res.status);
    const arr = await res.json();
    const list = arr.map(x => typeof x === "string" ? x : x.path).filter(Boolean);
    if(!list.length) throw new Error("manifest empty");
    return list;
  }catch(e){
    dbg.textContent = `manifest failed: ${e.message}`;
    return null;
  }
}

async function fetchGitHubContents(){
  let url = API_URL + "?cb=" + Date.now();
  try{
    const res = await fetch(url, {cache:"no-store"});
    dbg.textContent = `GET ${url}\nstatus ${res.status}`;
    if(!res.ok) throw new Error("api " + res.status);
    const data = await res.json();
    const list = data.filter(x => x.type === "file").map(x => x.name);
    if(!list.length) throw new Error("api empty");
    return list;
  }catch(e){
    dbg.textContent += `\napi failed: ${e.message}`;
    return null;
  }
}

/* ===== boot + auto-refresh ===== */
async function refresh(){
  // 1) manifest first (if you set up the Action), then 2) live API
  let list = await fetchManifest();
  if(list){ render(list, "manifest"); return; }
  list = await fetchGitHubContents();
  if(list){ render(list, "GitHub API"); return; }
  // nothing worked
  grid.innerHTML = "";
}

let timer=null;
function startPolling(){ if(!timer){ timer=setInterval(refresh, 60000); } }
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) refresh(); });

refresh();
startPolling();
</script>
</body>
</html>