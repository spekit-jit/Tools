<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meeting Orchestrator ¬∑ Roles ‚Ä¢ Agenda ‚Ä¢ Timer</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0e111a; --panel:#131829; --ink:#e9ecf8; --muted:#9aa3bf;
    --card:#0f1426; --primary:#5f8cff; --accent:#4fe1b8; --danger:#ff6b6b;
    --radius:16px; --shadow:0 10px 28px rgba(0,0,0,.35);
    --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f5f7fb; --panel:#fff; --card:#fff; --ink:#0f1426; --muted:#5b6786; --shadow:0 12px 28px rgba(12,24,60,.08); }
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1000px 400px at 0% -10%, rgba(95,140,255,.25), transparent 60%),radial-gradient(800px 300px at 110% 0%, rgba(79,225,184,.18), transparent 60%),var(--bg);font-family:var(--font);color:var(--ink)}
  .app{display:grid;grid-template-columns:420px 1fr;min-height:100svh}
  @media (max-width: 980px){.app{grid-template-columns:1fr}.right{order:-1}}
  .left{padding:18px;border-right:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.04),transparent),var(--panel)}
  .right{padding:18px}
  h1{font-size:20px;margin:4px 0 12px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:14px}
  .section{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:14px;margin-bottom:12px}
  .section h2{font-size:14px;margin:0 0 10px;letter-spacing:.3px}
  .grid{display:grid;gap:10px}
  .two{grid-template-columns:1fr 1fr}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:var(--primary);color:#fff;font-weight:600;cursor:pointer;box-shadow:0 8px 20px color-mix(in srgb,var(--primary),#000 80%)}
  .btn.ghost{background:transparent;color:var(--ink)}
  .btn.danger{background:var(--danger)}
  input[type="text"], input[type="number"], textarea{
    width:100%;padding:11px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(10,12,22,.45);color:var(--ink);
  }
  textarea{min-height:80px;resize:vertical}
  label{font-size:12px;color:var(--muted);display:block;margin:2px 0 6px}
  .roles{display:flex;flex-wrap:wrap;gap:8px}
  .role{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  .list{display:grid;gap:10px}
  .agendaItem{display:grid;grid-template-columns:1fr 80px 40px;gap:8px;align-items:center}
  .small{font-size:12px;color:var(--muted)}
  .frame{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  .hero{padding:18px 18px 10px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;gap:12px;align-items:center}
  .title{font-size:18px;font-weight:700}
  .timer{padding:14px 18px;display:grid;gap:10px}
  .timeBox{font-variant-numeric:tabular-nums;font-size:44px;font-weight:800;letter-spacing:.5px}
  .bar{height:10px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
  .bar>div{height:100%;width:0;background:linear-gradient(90deg,var(--primary),var(--accent))}
  .controls{display:flex;flex-wrap:wrap;gap:8px}
  .cards{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;padding:14px}
  .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--card);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
  .card h3{margin:0 0 8px;font-size:14px}
  @media (min-width:780px){.card.span6{grid-column:span 6}.card.span4{grid-column:span 4}}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;border:1px solid rgba(255,255,255,.18);border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-size:12px}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
</style>
</head>
<body>
  <div class="app">
    <!-- LEFT: Setup -->
    <div class="left">
      <h1>Meeting Orchestrator</h1>
      <div class="sub">Randomize roles, run a timed agenda, and export a clean recap. Zero backend, iframe-friendly.</div>

      <div class="section">
        <h2>Basics</h2>
        <div class="grid">
          <div>
            <label>Meeting Title</label>
            <input id="mtitle" type="text" placeholder="Q4 Revenue Acceleration Sync" />
          </div>
          <div>
            <label>Goal / Outcome</label>
            <input id="mgoal" type="text" placeholder="Decide pilot scope and next steps" />
          </div>
          <div>
            <label>Date (optional)</label>
            <input id="mdate" type="text" placeholder="Aug 24, 2025 ¬∑ 45 min" />
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Participants</h2>
        <label>Enter names (one per line)</label>
        <textarea id="participants" placeholder="Alex Chen&#10;Priya Shah&#10;Jordan Lee"></textarea>
        <label>Roles</label>
        <div class="roles" id="roleChips">
          <span class="role">Facilitator</span>
          <span class="role">Note-Taker</span>
          <span class="role">Timekeeper</span>
          <span class="role">Decision Owner</span>
          <span class="role">Challenger</span>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="assignBtn">üé≤ Assign Roles</button>
          <button class="btn ghost" id="clearRolesBtn">‚ôªÔ∏è Clear</button>
          <span class="small">Tip: re-roll until it looks balanced.</span>
        </div>
        <div id="assigned" class="small" style="margin-top:8px;color:var(--ink)"></div>
      </div>

      <div class="section">
        <h2>Agenda</h2>
        <div class="list" id="agendaList"></div>
        <div class="row">
          <button class="btn" id="addAgenda">‚ûï Add Item</button>
          <button class="btn ghost" id="loadSample">üí° Sample</button>
        </div>
        <div class="small" style="margin-top:6px">Each item has a title and minutes. Timebox total drives the master timer.</div>
      </div>

      <div class="section">
        <h2>Export</h2>
        <div class="row">
          <button class="btn" id="copyMd">üìã Copy Recap (MD)</button>
          <button class="btn ghost" id="downloadMd">‚¨áÔ∏è Download .md</button>
        </div>
        <div class="small" style="margin-top:6px">Works great for Slack, Notion, or deal room notes.</div>
      </div>
    </div>

    <!-- RIGHT: Live Run -->
    <div class="right">
      <div class="frame">
        <div class="hero">
          <div style="flex:1">
            <div class="title" id="titleView">Meeting</div>
            <div class="small" id="metaView"></div>
          </div>
          <div class="chip" id="goalView">üéØ Goal: <span class="mono" id="goalText">‚Äî</span></div>
        </div>

        <div class="timer">
          <div class="timeBox" id="clock">00:00</div>
          <div class="bar"><div id="barFill"></div></div>
          <div class="controls">
            <button class="btn" id="startBtn">‚ñ∂Ô∏é Start</button>
            <button class="btn ghost" id="pauseBtn">‚è∏ Pause</button>
            <button class="btn danger" id="resetBtn">‚ü≤ Reset</button>
            <span class="small">Hotkeys: <span class="kbd">S</span> start, <span class="kbd">P</span> pause, <span class="kbd">R</span> reset</span>
          </div>
        </div>

        <div class="cards" id="agendaView">
          <!-- agenda cards injected here -->
        </div>
      </div>
    </div>
  </div>

<script>
/* ===== Utilities ===== */
const $ = (id)=>document.getElementById(id);
const fmt = (s)=>s.toString().padStart(2,"0");

function parseParticipants(){
  return $("participants").value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
}
function getRoles(){
  return ["Facilitator","Note-Taker","Timekeeper","Decision Owner","Challenger"];
}
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

function minutesSum(){ return agenda.items.reduce((t,i)=>t+(+i.m||0),0); }

/* ===== State ===== */
const agenda = { items: [] };
let totalSeconds = 0, elapsed = 0, tHandle = null;

/* ===== Agenda UI ===== */
function renderAgendaEditor(){
  const wrap = $("agendaList");
  wrap.innerHTML = "";
  agenda.items.forEach((item, idx)=>{
    const row = document.createElement("div");
    row.className = "agendaItem";
    row.innerHTML = `
      <input type="text" placeholder="Topic ${idx+1}" value="${item.t||""}" data-idx="${idx}" data-key="t" />
      <input type="number" min="1" step="1" placeholder="min" value="${item.m||""}" data-idx="${idx}" data-key="m" />
      <button class="btn ghost" data-del="${idx}" title="Remove">‚úñ</button>
    `;
    wrap.appendChild(row);
  });
  const inputs = wrap.querySelectorAll("input");
  inputs.forEach(inp=>{
    inp.addEventListener("input",(e)=>{
      const i = +e.target.dataset.idx, k = e.target.dataset.key;
      agenda.items[i][k] = e.target.value;
      syncHeader();
      renderAgendaRun();
    });
  });
  wrap.querySelectorAll("button[data-del]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      const i = +e.target.dataset.del;
      agenda.items.splice(i,1);
      renderAgendaEditor();
      syncHeader();
      renderAgendaRun();
    });
  });
}
function addAgendaItem(t="",m=""){
  agenda.items.push({t, m});
  renderAgendaEditor();
  syncHeader();
  renderAgendaRun();
}

/* ===== Roles ===== */
function assignRoles(){
  const names = parseParticipants();
  const roles = getRoles();
  if(!names.length){ $("assigned").innerHTML = "<span class='small' style='color:var(--muted)'>Add participants first.</span>"; return; }
  const shuffled = shuffle(names.slice());
  const pairs = roles.map((r,i)=>[r, shuffled[i % shuffled.length]]);
  const html = pairs.map(([r,n])=>`<div class="chip">üß© <strong>${r}</strong>: ${n||"‚Äî"}</div>`).join(" ");
  $("assigned").innerHTML = html;
  return pairs;
}

/* ===== Run View ===== */
function syncHeader(){
  $("titleView").textContent = $("mtitle").value.trim() || "Meeting";
  $("metaView").textContent = $("mdate").value.trim() || "";
  $("goalText").textContent = $("mgoal").value.trim() || "‚Äî";
  totalSeconds = minutesSum()*60;
  if(elapsed>totalSeconds) elapsed = totalSeconds;
  updateClock();
  updateBar();
}

function renderAgendaRun(){
  const host = $("agendaView");
  host.innerHTML = "";
  if(!agenda.items.length){
    host.innerHTML = `<div class="card"><div class="small">Add agenda items on the left. Each gets its own timebox card here.</div></div>`;
    return;
  }
  agenda.items.forEach((it, idx)=>{
    const mins = +it.m||0;
    const card = document.createElement("section");
    card.className = "card span6";
    card.innerHTML = `
      <h3>${it.t ? escapeHtml(it.t) : "Topic "+(idx+1)} <span class="small">‚Ä¢ ${mins||0} min</span></h3>
      <div class="row">
        <button class="btn ghost" data-action="jump" data-idx="${idx}">‚è© Jump here</button>
        <button class="btn ghost" data-action="check" data-idx="${idx}">‚úîÔ∏è Mark done</button>
      </div>
      <div class="small" id="note-${idx}">Notes: <span class="mono">Tap to add</span></div>
    `;
    card.addEventListener("click",(e)=>{
      const tgt = e.target;
      if(tgt.dataset.action==="jump"){ jumpToIndex(idx); }
      if(tgt.dataset.action==="check"){ card.style.opacity=".6"; }
      if(tgt.id===`note-${idx}` || tgt.closest(`#note-${idx}`)){
        const old = (document.getElementById(`note-${idx}`).dataset.val)||"";
        const val = prompt("Add quick note for recap:", old) || "";
        document.getElementById(`note-${idx}`).dataset.val = val;
        document.getElementById(`note-${idx}`).innerHTML = `Notes: <span class="mono">${escapeHtml(val||"")}</span>`;
      }
    });
    host.appendChild(card);
  });
}

function escapeHtml(s=""){return s.replace(/[&<>"]/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[c]));}

/* ===== Timer Engine ===== */
let segmentIndex = 0;
function totalUpTo(i){ return agenda.items.slice(0,i).reduce((t,x)=>t+(+x.m||0),0)*60; }

function jumpToIndex(i){
  if(!agenda.items.length) return;
  segmentIndex = Math.max(0, Math.min(i, agenda.items.length-1));
  const base = totalUpTo(segmentIndex);
  elapsed = base;
  updateClock(); updateBar();
}

function tick(){
  if(!totalSeconds){ stop(); return; }
  elapsed = Math.min(elapsed+1, totalSeconds);
  if(elapsed>=totalSeconds) stop();
  updateClock(); updateBar();
}
function start(){ if(tHandle) return; tHandle = setInterval(tick,1000); }
function pause(){ if(!tHandle) return; clearInterval(tHandle); tHandle=null; }
function stop(){ pause(); }
function reset(){ pause(); elapsed = 0; segmentIndex = 0; updateClock(); updateBar(); }

function updateClock(){
  const rem = Math.max(totalSeconds - elapsed, 0);
  const mm = Math.floor(rem/60), ss = rem%60;
  $("clock").textContent = `${fmt(mm)}:${fmt(ss)}`;
}
function updateBar(){
  const pct = totalSeconds ? (elapsed/totalSeconds)*100 : 0;
  $("barFill").style.width = pct + "%";
}

/* ===== Export Recap ===== */
function buildMarkdown(){
  const title = $("mtitle").value.trim() || "Meeting";
  const when = $("mdate").value.trim() || "";
  const goal = $("mgoal").value.trim() || "";
  const parts = parseParticipants();
  // roles (latest assignment text)
  const assigned = $("assigned").innerText || "";
  const items = agenda.items.map((it,idx)=>{
    const mins = +it.m||0;
    const noteEl = document.getElementById(`note-${idx}`);
    const note = (noteEl && noteEl.dataset.val) ? noteEl.dataset.val : "";
    return `- **${it.t||"Topic "+(idx+1)}** (${mins} min)  \n  Notes: ${note||"‚Äî"}`;
  }).join("\n");

  return `# ${title}
${when ? "_"+when+"_\n" : ""}
**Goal:** ${goal||"‚Äî"}

**Participants:** ${parts.length ? parts.join(", ") : "‚Äî"}
**Roles:** ${assigned || "‚Äî"}

## Agenda
${items || "‚Äî"}

_Generated by Meeting Orchestrator._`;
}

function copyMd(){
  const md = buildMarkdown();
  navigator.clipboard.writeText(md).then(()=>{
    $("copyMd").textContent = "‚úî Copied!";
    setTimeout(()=>$("copyMd").textContent="üìã Copy Recap (MD)",1400);
  }).catch(()=>{ prompt("Copy Markdown:", md); });
}
function downloadMd(){
  const md = buildMarkdown();
  const blob = new Blob([md], {type:"text/markdown"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  const safe = ( $("mtitle").value.trim() || "meeting-recap" ).toLowerCase().replace(/[^a-z0-9]+/g,"-");
  a.href = url; a.download = `${safe}.md`;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
}

/* ===== Events ===== */
$("addAgenda").addEventListener("click", ()=>addAgendaItem());
$("loadSample").addEventListener("click", ()=>{
  agenda.items = [
    {t:"Kickoff & goals", m:5},
    {t:"Pipeline risks", m:10},
    {t:"Pilot scope & owners", m:15},
    {t:"Timeline & blockers", m:10},
    {t:"Decisions & next steps", m:5}
  ];
  renderAgendaEditor(); syncHeader(); renderAgendaRun();
});
$("assignBtn").addEventListener("click", assignRoles);
$("clearRolesBtn").addEventListener("click", ()=>{ $("assigned").innerHTML=""; });
$("copyMd").addEventListener("click", copyMd);
$("downloadMd").addEventListener("click", downloadMd);

$("startBtn").addEventListener("click", start);
$("pauseBtn").addEventListener("click", pause);
$("resetBtn").addEventListener("click", reset);

["mtitle","mgoal","mdate","participants"].forEach(id=>{
  $(id).addEventListener("input", ()=>{ syncHeader(); });
});

document.addEventListener("keydown",(e)=>{
  if(e.key.toLowerCase()==="s") start();
  if(e.key.toLowerCase()==="p") pause();
  if(e.key.toLowerCase()==="r") reset();
});

/* ===== Boot ===== */
addAgendaItem();
syncHeader();
renderAgendaRun();
renderAgendaEditor();
</script>
</body>
</html>
